# -*- coding: utf-8 -*-
"""app

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1139jnPC2UFSSF6WuVKLxeOR7llxKYOlj
"""

import streamlit as st
import pandas as pd
import pickle

# Load model dan encoder
with open('loan_model.pkl', 'rb') as f:
    model = pickle.load(f)
with open('encoder.pkl', 'rb') as f:
    encoder = pickle.load(f)
with open('ord_encoder.pkl', 'rb') as f:
    ord_encoder = pickle.load(f)
with open('scaler.pkl', 'rb') as f:
    scaler = pickle.load(f)

st.title("Loan Approval Prediction")

uploaded_file = st.file_uploader("Upload CSV untuk Prediksi", type=['csv'])

if uploaded_file:
    df = pd.read_csv(uploaded_file)

    # Preprocessing (mirip seperti di model.predict_from_file)
    df['person_gender'] = df['person_gender'].replace({'Male': 'male', 'fe male': 'female'})
    df.replace({
        "person_gender": {"male": 1, "female": 0},
        "previous_loan_defaults_on_file": {"Yes": 1, "No": 0}
    }, inplace=True)

    encoded = encoder.transform(df[['loan_intent', 'person_home_ownership']])
    df_encoded = pd.DataFrame(encoded.toarray(), columns=encoder.get_feature_names_out())
    df.reset_index(drop=True, inplace=True)
    df = pd.concat([df, df_encoded], axis=1)

    df[['person_education']] = ord_encoder.transform(df[['person_education']])
    df.drop(columns=['loan_intent', 'person_home_ownership'], inplace=True)

    cols_to_scale = [
        'person_age',
        'person_income',
        'person_emp_exp',
        'loan_amnt',
        'loan_int_rate',
        'loan_percent_income',
        'cb_person_cred_hist_length',
        'credit_score'
    ]
    df[cols_to_scale] = scaler.transform(df[cols_to_scale])

    pred = model.predict(df)
    df['loan_prediction'] = pred
    st.write(df[['loan_prediction']])